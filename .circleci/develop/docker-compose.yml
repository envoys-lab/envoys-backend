version: "3.8"

services:

  app:
    image: registry.beta.envoys.vision/envoys-backend:develop-${VERSION}
    restart: always
    environment:
      SERVER_PORT: 3000
      DB_CONNECTION_STRING: mongodb://user:GTjLedypWA3bETXT@mongodb:27017/envoys
      KYC_TOKEN: 03a976e10e1f2248b728e23206a417256267
      KYC_FORM_ID_PERSON: cd30862608f8024d242a162247a142be577e
      KYC_FORM_ID_COMPANY: 09a3bfe704b5224f842b1a82d241a144018a
      ADMIN_AUTH_TOKEN: 239231db00638243fa0b1d03488842ea1c06
      ACCESS_KEY_ID: AKIA5DNGX2QXHMH7UFV7
      SECRET_ACCESS_KEY: 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
      AWS_REGION: eu-west-3
      S3_BUCKET_NAME: envoysvision
    expose:
      - "3000"
    networks:
      - envoys-docker_default
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.backend.rule=Host(`api.beta.envoys.vision`)"
      - "traefik.http.routers.backend.entrypoints=websecure"
      - "traefik.http.services.backend.loadbalancer.server.port=3000"
      - "traefik.http.routers.backend.service=backend"
      - "traefik.http.routers.backend.tls.certresolver=leresolver"
      - "traefik.http.routers.backend.middlewares=cors@docker"

networks:
  envoys-docker_default:
    external: true
